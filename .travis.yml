language: c

compiler:
  - gcc
  - clang

jobs:
  - include:
    - stage: demos-build
      os: linux
      compiler: gcc
      script: make clean all
    - stage: demos-build-cmake
      os: linux
      compiler: gcc
      script: mkdir build && cd build && cmake .. && cmake --build . --clean-first
    - stage: gateway-build
      os: linux
      compiler: gcc
      script: make clean gateway
    - stage: lint
      os: linux
      compiler: clang
      # script: scan-build --status-bugs -analyze-headers -v make -j2 clean server
      script: skip
    - stage: ports-arm
      os: linux
      before_script:
        - wget -O $HOME/gcc-arm.tar.bz2 https://developer.arm.com/-/media/Files/downloads/gnu-rm/9-2019q4/RC2.1/gcc-arm-none-eabi-9-2019-q4-major-x86_64-linux.tar.bz2?revision=6e63531f-8cb1-40b9-bbfc-8a57cdfc01b4&la=en&hash=F761343D43A0587E8AC0925B723C04DBFB848339
        - tar -xvjf $HOME/gcc-arm.tar.bz2
        - export PATH=$PATH:$PWD/gcc-arm-none-eabi-9-2019-q4-major/bin/
        - arm-none-eabi-gcc --version
      script:
        - make stm32f10x
        - make at91sam7s
