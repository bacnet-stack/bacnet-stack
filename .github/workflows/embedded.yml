name: Embedded ARM and AVR

on:
  push:
    branches:
      - master
  pull_request:
    branches:    
      - '*'

jobs:
  gateway:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Create Build Environment
      run: 
        sudo apt-get update -qq
        sudo apt-get install -qq libconfig-dev
    - name: Build Gateway Demo
      compiler: gcc
      run: make clean gateway

jobs:
  router:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Create Build Environment
      run: 
        sudo apt-get update -qq
        sudo apt-get install -qq libconfig-dev
    - name: Build Router Demo
      compiler: gcc
      run: make clean router

jobs:
  router-ipv6:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Create Build Environment
      run: 
        sudo apt-get update -qq
        sudo apt-get install -qq libconfig-dev
    - name: Build Router IPv6 Demo
      compiler: gcc
      run: make clean router-ipv6

jobs:
  router-mstp:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Create Build Environment
      run: 
        sudo apt-get update -qq
        sudo apt-get install -qq libconfig-dev
    - name: Build Router MSTP Demo
      compiler: gcc
      run: make clean router-mstp

jobs:
  mstp:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Create Build Environment
      run: 
        sudo apt-get update -qq
        sudo apt-get install -qq libconfig-dev
    - name: Build MSTP Demos
      compiler: gcc
      run: make clean mstp

jobs:
  ethernet:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Create Build Environment
      run: 
        sudo apt-get update -qq
        sudo apt-get install -qq libconfig-dev
    - name: Build Ethernet Demos
      compiler: gcc
      run: make clean ethernet

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Create Build Environment
      run: |
        sudo apt-get update -qq
        sudo apt-get install -qq clang-tools
        sudo apt-get install -qq cppcheck
    - name: Lint
      compiler: clang
      run: make clean lint
    - name: cppcheck
      compiler: gcc
      run: make clean cppcheck

jobs:
  ports-arm:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Create Build Environment
      run: |
        sudo apt-get update -qq
        sudo apt-get install -qq build-essential
        sudo apt-get install -qq gcc-arm-none-eabi
        sudo apt-get install -qq libnewlib-arm-none-eabi
    - name: ports-arm
      run: |
        make clean
        arm-none-eabi-gcc --version
        make stm32f10x
        make stm32f4xx
        make at91sam7s

jobs:
  ports-avr:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Create Build Environment
      run: |
        sudo apt-get update -qq
        sudo apt-get install -qq build-essential
        sudo apt-get install -qq gcc-avr avr-libc binutils-avr
    - name: ports-avr
      run: |
        avr-gcc --version
        make atmega168
        make bdk-atxx4-mstp

jobs:
  ports-avr:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Create Build Environment
      run: |
        sudo apt-get update -qq
        sudo apt-get install -qq build-essential
        sudo apt-get install -qq mingw-w64
    - name: Build Win32 Demos
      run: |
        export CC=i686-w64-mingw32-gcc
        export LD=i686-w64-mingw32-ld
        i686-w64-mingw32-gcc --version
        make win32

